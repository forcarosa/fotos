<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Força Rosa — Enviar Foto</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <main class="card">
    <header>
      <h1>Quiz Força Rosa — Enviar Foto</h1>
      <p class="subtitle">Escaneie o QR de upload ou use esta página para enviar uma foto. Após o envio você receberá um QR para visualizar a imagem.</p>
    </header>

    <label class="file-label">
      <input id="file" type="file" accept="image/*" />
      <span>Escolher foto</span>
    </label>

    <div class="actions">
      <button id="send">Enviar</button>
    </div>

    <div id="result" class="result"></div>

    <footer>
      <p>Protegido por Cloudflare R2 — links expiram automaticamente.</p>
    </footer>
  </main>

<script>
document.getElementById('send').addEventListener('click', async () => {
  const f = document.getElementById('file').files[0];
  if (!f) return alert('Escolha uma foto primeiro.');
  const form = new FormData();
  form.append('photo', f);

  const resEl = document.getElementById('result');
  resEl.innerHTML = 'Enviando...';

  try {
    const resp = await fetch('/upload', { method: 'POST', body: form });
    const data = await resp.json();
    if (!resp.ok) {
      resEl.innerHTML = `<p class="error">Erro: ${data.error || JSON.stringify(data)}</p>`;
      return;
    }
    resEl.innerHTML = `
      <p>Visualizar (link temporário): <a href="${data.viewUrl}" target="_blank">Abrir imagem</a></p>
      <p><img src="${data.qrDataUrl}" alt="QR da imagem" style="max-width:260px" /></p>
      <p class="muted">ID: ${data.id}</p>
    `;
  } catch (err) {
    resEl.innerHTML = `<p class="error">Erro: ${err.message}</p>`;
  }
});
</script>
</body>
</html>